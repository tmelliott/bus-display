{"version":3,"sources":["components/VehicleMap.js","components/BarChart.js","components/InfoPanel.js","App.js","reportWebVitals.js","index.js"],"names":["mapboxgl","workerClass","MapboxWorker","accessToken","process","VehicleMap","vehicles","refresh","palette","mapContainer","useRef","useState","lng","lat","zoom","container","setContainer","map","setMap","svg","setSvg","data","setData","useEffect","console","log","Map","current","style","layers","center","undefined","on","scrollZoom","disable","getCanvasContainer","d3","append","attr","length","v","id","key","pos","project","LngLat","position","longitude","latitude","occ_stat","occupancy_status","status","circles","selectAll","d","exit","transition","duration","remove","enter","x","y","Container","ref","styled","div","BarChart","xlab","maxCount","setMaxCount","Math","max","apply","count","Label","Column","Bar","height","colour","BarCount","BarLabel","label","props","InfoPanel","App","feed","setFeed","setVehicles","occupancyTable","setOccupancyTable","delaysTable","setDelaysTable","occupancyPalette","reverse","fetching","fetchData","fetch","headers","then","response","ok","json","entity","interval","setInterval","refresh_rate","clearInterval","filter","f","vehicle","is_deleted","ft","f2","trip_update","occ","tbl","Array","fill","i","delays","stop_time_update","arrival","delay","departure","Charts","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"4SASAA,IAASC,YAAcC,IACvBF,IAASG,YAAcC,mGAoIRC,I,YAAAA,EAlIf,YAAmD,IAA9BC,EAA6B,EAA7BA,SAAUC,EAAmB,EAAnBA,QAASC,EAAU,EAAVA,QAC9BC,EAAeC,mBADyB,EAEhCC,mBAAS,YAAhBC,EAFuC,sBAGhCD,oBAAU,WAAjBE,EAHuC,sBAI/BF,mBAAS,IAAjBG,EAJuC,sBAMZH,qBANY,mBAMvCI,EANuC,KAM5BC,EAN4B,OAOxBL,qBAPwB,mBAOvCM,EAPuC,KAOlCC,EAPkC,OAQxBP,qBARwB,mBAQvCQ,EARuC,KAQlCC,EARkC,OAStBT,mBAAS,IATa,mBASvCU,EATuC,KASjCC,EATiC,KA2H9C,OAhHAC,qBAAU,WACNC,QAAQC,IAAI,iBACZP,EACI,IAAIlB,IAAS0B,IAAI,CACbX,UAAWN,EAAakB,QACxBC,MAAO,CACH,QAAW,EACX,QAAW,CACP,eAAgB,CACZ,KAAQ,SACR,MAAS,CACL,gFAEJ,SAAY,MAGpBC,OAAQ,CACJ,CACI,GAAO,eACP,KAAQ,SACR,OAAU,eACV,QAAW,EACX,QAAW,MAIvBC,OAAQ,CAAClB,EAAKC,GACdC,KAAMA,OAKf,CAACD,EAAKD,EAAKE,IAEdS,qBAAU,gBACMQ,IAARd,IACJO,QAAQC,IAAI,uBACZR,EAAIe,GAAG,QAAQ,WACXf,EAAIgB,WAAWC,UACflB,EAAaC,EAAIkB,4BAEtB,CAAClB,IAEJM,qBAAU,WACN,QAAkBQ,IAAdhB,EAYJ,OAXAS,QAAQC,IAAI,iBACZL,EACIgB,IAAUrB,GACLsB,OAAO,OACPC,KAAK,SAAU,QACfA,KAAK,QAAS,QACdV,MAAM,WAAY,YAClBA,MAAM,UAAW,MAInB,kBAAMR,OACd,CAACL,IAGJQ,qBAAU,gBACMQ,IAARZ,GACoB,IAApBb,EAASiC,SACbf,QAAQC,IAAI,kBACZH,EACIhB,EAASW,KAAI,SAAAuB,GAAC,MAAK,CACfC,GAAID,EAAEE,IACNC,IAAK1B,EAAI2B,QACL,IAAI5C,IAAS6C,OACTL,EAAEM,SAASC,UACXP,EAAEM,SAASE,WAGnBC,SAAUT,EAAEU,iBACZC,YAA+BpB,IAAvBS,EAAEU,iBAAiC,EAAIV,EAAEU,iBAAmB,UAG7E,CAAC/B,EAAKb,EAAUW,IAEnBM,qBAAU,WACN,GAAoB,IAAhBF,EAAKkB,OAAT,CAEAf,QAAQC,IAAI,yBACZ,IAAI2B,EAAUjC,EACTkC,UAAU,UACVhC,KAAKA,GAAM,SAAAiC,GAAC,OAAIA,EAAEb,MAwBvB,OAtBAW,EAAQG,OACHC,aACAC,SAAS,KACTnB,KAAK,IAAK,GACVoB,SAELN,EAAQO,QACHtB,OAAO,UACPT,MAAM,QAAQ,SAAA0B,GAAC,OAAI9C,EAAQ8C,EAAEH,WAC7Bb,KAAK,IAAK,GACVA,KAAK,MAAM,SAAAgB,GAAC,OAAIA,EAAEX,IAAIiB,KACtBtB,KAAK,MAAM,SAAAgB,GAAC,OAAIA,EAAEX,IAAIkB,KACtBL,aACAC,SAAS,KACTnB,KAAK,IAAK,GAEfc,EAAQI,aACHC,SAASlD,GACT+B,KAAK,MAAM,SAAAgB,GAAC,OAAIA,EAAEX,IAAIiB,KACtBtB,KAAK,MAAM,SAAAgB,GAAC,OAAIA,EAAEX,IAAIkB,KACtBjC,MAAM,QAAQ,SAAA0B,GAAC,OAAI9C,EAAQ8C,EAAEH,WAE3B,kBAAMhC,EAAIkC,UAAU,UAAUhC,KAAK,QAC3C,CAACA,EAAMF,EAAKF,EAAKT,EAASD,IAGzB,cAACuD,EAAD,UACI,cAACpC,EAAD,CAAKqC,IAAKtD,OAOhBqD,EAAYE,IAAOC,IAAV,0BAETvC,EAAMsC,IAAOC,IAAV,8ICnHMC,I,EAAAA,EA5Bf,YAAiC,IAAd7C,EAAa,EAAbA,KAAM8C,EAAO,EAAPA,KAAO,EAEIxD,mBAAS,GAFb,mBAErByD,EAFqB,KAEXC,EAFW,KAW5B,OAPA9C,qBAAU,WACc,IAAhBF,EAAKkB,QACT8B,EACIC,KAAKC,IAAIC,MAAMF,KAAMjD,EAAKJ,KAAI,SAAAqC,GAAC,OAAIA,EAAEmB,aAE1C,CAACpD,IAGA,eAAC,EAAD,WACI,cAACqD,EAAD,UAAQP,IACP9C,EAAKkB,QAAUlB,EAAKJ,KAAI,SAAAqC,GAAC,OACtB,eAACqB,EAAD,WACI,cAACC,EAAD,CACIC,OAAevB,EAAEmB,MAAQL,EAAjB,IACRU,OAAQxB,EAAEwB,SAEd,cAACC,EAAD,UAAWzB,EAAEmB,QACb,cAACO,EAAD,UAAW1B,EAAE2B,kBAS3BnB,EAAYE,IAAOC,IAAV,wQAaTS,EAAQV,IAAOC,IAAV,2JAQLU,EAASX,IAAOC,IAAV,oOAWNW,EAAMZ,IAAOC,IAAV,gUAWQ,SAAAiB,GAAK,OAAIA,EAAML,UACV,SAAAK,GAAK,OAAIA,EAAMJ,UAK/BC,EAAWf,IAAOC,IAAV,8IAQRe,EAAWhB,IAAOC,IAAV,kNCrECkB,I,IAAAA,EAlBf,WACI,OACI,eAAC,EAAD,WACI,8BACI,kEADJ,wEACsH,8DADtH,qDACiN,uEADjN,mBACmR,6CADnR,OAGA,2EAC8C,sDAD9C,8DAcNrB,EAAYE,IAAOC,IAAV,sUC0IAmB,MAxJf,WAGE,IAHa,EAKWzE,mBAAS,IALpB,mBAKN0E,EALM,KAKAC,EALA,OAMmB3E,mBAAS,IAN5B,mBAMNL,EANM,KAMIiF,EANJ,OAO+B5E,mBAAS,IAPxC,mBAON6E,EAPM,KAOUC,EAPV,OAQyB9E,mBAAS,IARlC,mBAQN+E,EARM,KAQOC,EARP,KAYPC,EADO,sBAAOxD,IAAkB,IAAzB,CAA6B,YACTyD,UAuHjC,OApHAtE,qBAAU,WACR,IAAIuE,GAAW,EAETC,EAAY,WAChB,IAAID,EAAJ,CACAtE,QAAQC,IAAI,wBACZqE,GAAW,EAkBX,OAZAE,MAAM,6CAA8C,CAAEC,QAJtC,CACd,4BAA6B7F,sCAI5B8F,MAAK,SAAAC,GACJ,GAAIA,EAASC,GACX,OAAOD,EAASE,OAElB7E,QAAQC,IAAI0E,MAEbD,MAAK,SAAA7E,GAAI,OAAIiE,EAAQjE,EAAK8E,SAASG,WACnCJ,MAAK,WACJJ,GAAW,KAGR,WACLA,GAAW,KAIfC,IACA,IAAIQ,EAAWC,aAAY,kBAAMT,MAAaU,KAE9C,OAAO,kBAAMC,cAAcH,MAC1B,IAGHhF,qBAAU,WACRgE,EACEF,EACGsB,QACC,SAAAC,GAAC,OAAIA,EAAEC,UAAYD,EAAEE,YACnBF,EAAEC,QAAQ/D,YAEb7B,KACC,SAAA2F,GAAM,IAAD,EACCG,EAAK1B,EAAKsB,QACZ,SAAAK,GAAE,aACAA,EAAGC,cACH,UAAAD,EAAGC,YAAYJ,eAAf,eAAwBpE,MAAOmE,EAAEC,QAAQA,QAAQpE,MAErD,OAAO,2BACFmE,EAAEC,SADP,IAEEnE,IAAKkE,EAAEC,QAAQA,QAAQpE,GACvBwE,YAAW,UAAEF,EAAG,UAAL,aAAE,EAAOE,oBAK7B,CAAC5B,IAEJ9D,qBAAU,WAIR,IAFA,IAAI2F,EAAM5G,EAASW,KAAI,SAAAuB,GAAC,YAA2BT,IAAvBS,EAAEU,iBAAiC,EAAIV,EAAEU,iBAAmB,KACpFiE,EAAM,IAAIC,MAAM,GAAGC,KAAK,GACnBC,EAAE,EAAEA,EAAEJ,EAAI3E,OAAO+E,IACxBH,EAAID,EAAII,MAEV7B,EAAkB,CAChB,CAAC,MAAS,UAAW,MAAS0B,EAAI,GAAI,OAAUvB,EAAiB,IACjE,CAAC,MAAS,QAAS,MAASuB,EAAI,GAAI,OAAUvB,EAAiB,IAC/D,CAAC,MAAS,aAAc,MAASuB,EAAI,GAAI,OAAUvB,EAAiB,IACpE,CAAC,MAAS,YAAa,MAASuB,EAAI,GAAI,OAAUvB,EAAiB,IACnE,CAAC,MAAS,qBAAsB,MAASuB,EAAI,GAAI,OAAUvB,EAAiB,IAC5E,CAAC,MAAS,6BAA8B,MAASuB,EAAI,GAAI,OAAUvB,EAAiB,IACpF,CAAC,MAAS,OAAQ,MAASuB,EAAI,GAAI,OAAUvB,EAAiB,IAC9D,CAAC,MAAS,2BAA4B,MAASuB,EAAI,GAAI,OAAUvB,EAAiB,MAGpF,IAAI2B,EAASjH,EAASW,KAAI,SAAAuB,GACxB,QAAsBT,IAAlBS,EAAEyE,YACN,OAAOzE,EAAEyE,YAAYO,iBAAiBC,QACpCjF,EAAEyE,YAAYO,iBAAiBC,QAAQC,MACvClF,EAAEyE,YAAYO,iBAAiBG,UAAUD,SAG7CP,EAAM,IAAIC,MAAM,GAAGC,KAAK,GACxB7F,QAAQC,IAAI8F,GACZ,IAAK,IAAID,EAAE,EAAEA,EAAEC,EAAOhF,OAAO+E,SACTvF,IAAdwF,EAAOD,GAAkBH,EAAI,KACxBI,EAAOD,KAAO,IAAKH,EAAI,KACvBI,EAAOD,IAAM,GAAIH,EAAI,KACrBI,EAAOD,IAAM,IAAKH,EAAI,KACtBI,EAAOD,IAAM,IAAKH,EAAI,KACtBI,EAAOD,IAAM,KAAMH,EAAI,KACvBI,EAAOD,IAAM,KAAMH,EAAI,KAC3BA,EAAI,KAEXxB,EAAe,CACb,CAAC,MAAS,UAAW,MAASwB,EAAI,GAAI,OAAU,WAChD,CAAC,MAAS,YAAa,MAASA,EAAI,GAAI,OAAU,WAClD,CAAC,MAAS,aAAc,MAASA,EAAI,GAAI,OAAU,WACnD,CAAC,MAAS,UAAW,MAASA,EAAI,GAAI,OAAU,WAChD,CAAC,MAAS,aAAc,MAASA,EAAI,GAAI,OAAU,WACnD,CAAC,MAAS,cAAe,MAASA,EAAI,GAAI,OAAU,WACpD,CAAC,MAAS,cAAe,MAASA,EAAI,GAAI,OAAU,OACpD,CAAC,MAAS,YAAa,MAASA,EAAI,GAAI,OAAU,eAGnD,CAAC7G,IASF,eAAC,EAAD,WACE,cAAC,EAAD,CAAYA,SAAUA,EACpBC,QAAS,KACTC,QAASoF,IAGX,cAAC,EAAD,IAEA,eAACgC,EAAD,WACE,cAAC,EAAD,CAAUvG,KAAMmE,EACdrB,KAAK,qBAEP,cAAC,EAAD,CAAU9C,KAAMqE,EACdvB,KAAK,wCASTL,EAAYE,IAAOC,IAAV,0BAET2D,EAAS5D,IAAOC,IAAV,2FCzJG4D,EAZS,SAAAC,GAClBA,GAAeA,aAAuBC,UACxC,8BAAqB7B,MAAK,YAAkD,IAA/C8B,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOF,GACPG,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAQN,OCDdO,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,EAAD,MAEFC,SAASC,eAAe,SAM1BZ,M","file":"static/js/main.6273bf76.chunk.js","sourcesContent":["import React, { useState, useRef, useEffect } from 'react'\nimport styled from 'styled-components'\n\nimport mapboxgl from 'mapbox-gl/dist/mapbox-gl'\n// eslint-disable-next-line import/no-webpack-loader-syntax\nimport MapboxWorker from 'worker-loader!mapbox-gl/dist/mapbox-gl-csp-worker'\n\nimport * as d3 from 'd3'\n\nmapboxgl.workerClass = MapboxWorker\nmapboxgl.accessToken = process.env.REACT_APP_MAPBOX_API_KEY\n\nfunction VehicleMap({vehicles, refresh, palette}) {\n    const mapContainer = useRef()\n    const [lng] = useState(174.860478)\n    const [lat] = useState(-36.845794)\n    const [zoom] = useState(10)\n\n    const [container, setContainer] = useState()\n    const [map, setMap] = useState()\n    const [svg, setSvg] = useState()\n    const [data, setData] = useState([])\n\n    useEffect(() => {\n        console.log(\"-- set map --\")\n        setMap(\n            new mapboxgl.Map({\n                container: mapContainer.current,\n                style: {\n                    'version': 8,\n                    'sources': {\n                        'raster-tiles': {\n                            'type': 'raster',\n                            'tiles': [\n                                'https://abcd.basemaps.cartocdn.com/rastertiles/dark_nolabels/{z}/{x}/{y}.png'\n                            ],\n                            'tileSize': 256,\n                        }\n                    },\n                    layers: [\n                        {\n                            'id':  'simple-tiles',\n                            'type': 'raster',\n                            'source': 'raster-tiles',\n                            'minzoom': 0,\n                            'maxzoom': 22\n                        }\n                    ],\n                },\n                center: [lng, lat],\n                zoom: zoom\n            })\n        )\n\n        // return () => map.remove()\n    }, [lat, lng, zoom])\n\n    useEffect(() => {\n        if (map === undefined) return\n        console.log(\"-- set container --\")\n        map.on('load', () => {\n            map.scrollZoom.disable()\n            setContainer(map.getCanvasContainer())\n        })\n    }, [map])\n\n    useEffect(() => {\n        if (container === undefined) return\n        console.log(\"-- set svg --\")\n        setSvg(\n            d3.select(container)\n                .append('svg')\n                .attr(\"height\", \"100%\")\n                .attr(\"width\", \"100%\")\n                .style(\"position\", \"absolute\")\n                .style(\"z-index\", \"2\")\n                // .style(\"background\", \"pink\")\n        )\n\n        return () => setSvg()\n    }, [container])\n\n\n    useEffect(() => {\n        if (svg === undefined) return\n        if (vehicles.length === 0) return\n        console.log(\"-- set data --\")\n        setData(\n            vehicles.map(v => ({\n                id: v.key,\n                pos: map.project(\n                    new mapboxgl.LngLat(\n                        v.position.longitude,\n                        v.position.latitude\n                    )\n                ),\n                occ_stat: v.occupancy_status,\n                status: v.occupancy_status === undefined ? 0 : v.occupancy_status + 1,\n            }))\n        )\n    }, [svg, vehicles, map])\n\n    useEffect(() => {\n        if (data.length === 0) return\n\n        console.log(\"-- set data points --\")\n        let circles = svg\n            .selectAll('circle')\n            .data(data, d => d.id)\n\n        circles.exit()\n            .transition()\n            .duration(500)\n            .attr('r', 0)\n            .remove()\n\n        circles.enter()\n            .append('circle')\n            .style('fill', d => palette[d.status])\n            .attr('r', 0)\n            .attr('cx', d => d.pos.x)\n            .attr('cy', d => d.pos.y)\n            .transition()\n            .duration(500)\n            .attr('r', 5)\n\n        circles.transition()\n            .duration(refresh)\n            .attr('cx', d => d.pos.x)\n            .attr('cy', d => d.pos.y)\n            .style('fill', d => palette[d.status])\n\n        return () => svg.selectAll('circle').data([])\n    }, [data, svg, map, palette, refresh])\n\n    return (\n        <Container>\n            <Map ref={mapContainer} />\n        </Container>\n    )\n}\n\nexport default VehicleMap\n\nconst Container = styled.div``\n\nconst Map = styled.div`\n    position: fixed;\n    top: 0;\n    left: 0;\n    height: 100vh;\n    width: 100vw;\n    background: #262626;\n`\n","import React, { useEffect, useState } from 'react'\nimport styled from 'styled-components'\n\nfunction BarChart({data, xlab}) {\n\n    const [maxCount, setMaxCount] = useState(0)\n\n    useEffect(() => {\n        if (data.length === 0) return\n        setMaxCount(\n            Math.max.apply(Math, data.map(d => d.count))\n        )\n    }, [data])\n\n    return (\n        <Container>\n            <Label>{xlab}</Label>\n            {data.length && data.map(d => (\n                <Column>\n                    <Bar\n                        height={100 * (d.count / maxCount)}\n                        colour={d.colour}\n                        />\n                    <BarCount>{d.count}</BarCount>\n                    <BarLabel>{d.label}</BarLabel>\n                </Column>\n            ))}\n        </Container>\n    )\n}\n\nexport default BarChart\n\nconst Container = styled.div`\n    margin-bottom: 2em;\n    /* left: 2em;\n    bottom: 2em; */\n    height: 30vh;\n    width: 30vw;\n    display: flex;\n    flex-direction: column;\n    background: rgba(0,0,0,0.3);\n    padding: 0.5em;\n    border: solid 4px white;\n`\n\nconst Label = styled.div`\n    color: white;\n    /* width: 180px; */\n    /* text-align: right; */\n    font-weight: bold;\n    /* background: pink; */\n`\n\nconst Column = styled.div`\n    width: 100%;\n    flex: 1;\n    display: flex;\n    flex-direction: row-reverse;\n    color: white;\n    text-align: center;\n    font-weight: bold;\n    font-size: 0.7em;\n    overflow: hidden;\n`\nconst Bar = styled.div`\n    flex: 1;\n    margin: 2px 0;\n    position: relative;\n\n    &:before {\n        content: '';\n        display: block;\n        position: absolute;\n        height: 100%;\n        left: 0;\n        width: ${props => props.height}%;\n        background: ${props => props.colour};\n        transition: width 5s ease-in-out;\n    }\n`\n\nconst BarCount = styled.div`\n    padding: 0.5em;\n    width: 3em;\n    align-items: center;\n    display: flex;\n    justify-content: center;\n`\n\nconst BarLabel = styled.div`\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    border-right: solid 1px white;\n    padding-right: 10px;\n    width: 180px;\n    overflow: hidden;\n`\n","import React from 'react'\nimport styled from 'styled-components'\n\nfunction InfoPanel() {\n    return (\n        <Container>\n            <p>\n                <strong>Real-time positions of buses</strong> are obtained through Auckland Tranport's public API, which includes <strong>arrival/departure delays</strong> at the most recently visited stop. Buses between <strong>1 minute early and 5 minutes late</strong> are defined as <strong>on time</strong>.\n            </p>\n            <p>\n                Location points are coloured by the bus's <strong>occupancy status</strong>, which indicates the number of passengers on board.\n            </p>\n            {/* <p>\n                The line graph shows how the <strong>percentage of buses\n                that are on time, early</strong> (by more than 1 minute), <strong>and late</strong>\n                (by more than 5 minutes) has changed today.\n            </p> */}\n        </Container>\n    )\n}\n\nexport default InfoPanel\n\nconst Container = styled.div`\n    position: fixed;\n    top: 1.0em;\n    left: 1.0em;\n    width: 25vw;\n    z-index: 1000;\n\n    font-size: 1.2rem;\n    line-height: 1.5;\n    background: rgba(0,0,0,0.4);\n    padding: 1em 2em 0;\n    color: #fff;\n    border: 4px solid #fff;\n\n    p {\n        margin: 0 0 1em 0;\n    }\n\n`\n","import { useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport * as d3 from 'd3'\n\nimport './App.css'\nimport VehicleMap from './components/VehicleMap';\nimport BarChart from './components/BarChart';\nimport InfoPanel from './components/InfoPanel';\n\nfunction App() {\n\n  // Timing information:\n  const refresh_rate = 30\n\n  const [feed, setFeed] = useState([])\n  const [vehicles, setVehicles] = useState([])\n  const [occupancyTable, setOccupancyTable] = useState([])\n  const [delaysTable, setDelaysTable] = useState([])\n\n\n  const specPal = [...d3.schemeSpectral[7], '#cecece']\n  const occupancyPalette = specPal.reverse()\n\n  // Run when the app loads:\n  useEffect(() => {\n    let fetching = false\n\n    const fetchData = () => {\n      if (fetching) return\n      console.log(\" --- fetch data --- \")\n      fetching = true\n\n      const headers = {\n        \"Ocp-Apim-Subscription-Key\": process.env.REACT_APP_AT_API_KEY,\n      }\n\n      fetch(\"https://api.at.govt.nz/v2/public/realtime/\", { headers })\n        .then(response => {\n          if (response.ok) {\n            return response.json()\n          }\n          console.log(response)\n        })\n        .then(data => setFeed(data.response.entity))\n        .then(() => {\n          fetching = false\n        })\n\n      return () => {\n        fetching = false\n      }\n    }\n\n    fetchData()\n    let interval = setInterval(() => fetchData(), refresh_rate * 1000)\n\n    return () => clearInterval(interval)\n  }, [])\n\n  // Run when the feed changes:\n  useEffect(() => {\n    setVehicles(\n      feed\n        .filter(\n          f => f.vehicle && !f.is_deleted &&\n            f.vehicle.position\n        )\n        .map(\n          f => {\n            let ft = feed.filter(\n              f2 =>\n                f2.trip_update &&\n                f2.trip_update.vehicle?.id === f.vehicle.vehicle.id\n            )\n            return {\n              ...f.vehicle,\n              key: f.vehicle.vehicle.id,\n              trip_update: ft[0]?.trip_update,\n            }\n          }\n        )\n    )\n  }, [feed])\n\n  useEffect(() => {\n    // create occupancy table\n    let occ = vehicles.map(v => v.occupancy_status === undefined ? 0 : v.occupancy_status + 1)\n    let tbl = new Array(8).fill(0)\n    for (let i=0;i<occ.length;i++) {\n      tbl[occ[i]]++\n    }\n    setOccupancyTable([\n      {'label': 'Unknown', 'count': tbl[0], 'colour': occupancyPalette[0]},\n      {'label': 'Empty', 'count': tbl[1], 'colour': occupancyPalette[1]},\n      {'label': 'Many seats', 'count': tbl[2], 'colour': occupancyPalette[2]},\n      {'label': 'Few seats', 'count': tbl[3], 'colour': occupancyPalette[3]},\n      {'label': 'Standing room only', 'count': tbl[4], 'colour': occupancyPalette[4]},\n      {'label': 'Crushed standing room only', 'count': tbl[5], 'colour': occupancyPalette[5]},\n      {'label': 'Full', 'count': tbl[6], 'colour': occupancyPalette[6]},\n      {'label': 'Not accepting passengers', 'count': tbl[7], 'colour': occupancyPalette[7]},\n    ])\n\n    let delays = vehicles.map(v => {\n      if (v.trip_update === undefined) return\n      return v.trip_update.stop_time_update.arrival ?\n        v.trip_update.stop_time_update.arrival.delay :\n        v.trip_update.stop_time_update.departure.delay\n    })\n\n    tbl = new Array(8).fill(0)\n    console.log(delays)\n    for (let i=0;i<delays.length;i++) {\n      if (delays[i] === undefined) tbl[0]++\n      else if (delays[i] <= -300) tbl[1]++\n      else if (delays[i] <= 60) tbl[2]++\n      else if (delays[i] >= 300) tbl[3]++\n      else if (delays[i] >= 600) tbl[4]++\n      else if (delays[i] >= 1200) tbl[5]++\n      else if (delays[i] >= 1800) tbl[6]++\n      else tbl[7]++\n    }\n    setDelaysTable([\n      {'label': 'No data', 'count': tbl[0], 'colour': '#95a5a6'},\n      {'label': '>5m early', 'count': tbl[1], 'colour': '#3c42a5'},\n      {'label': '1-5m early', 'count': tbl[2], 'colour': '#28aebb'},\n      {'label': 'On time', 'count': tbl[3], 'colour': '#26d926'},\n      {'label': '5-10m late', 'count': tbl[4], 'colour': '#f39c12'},\n      {'label': '10-20m late', 'count': tbl[5], 'colour': '#d35400'},\n      {'label': '20-30m late', 'count': tbl[6], 'colour': 'red'},\n      {'label': '30+m late', 'count': tbl[7], 'colour': '#990000'},\n    ])\n\n  }, [vehicles])\n\n\n\n  // useEffect(() => {\n  //   console.log(occupancyTable)\n  // }, [occupancyTable])\n\n  return (\n    <Container>\n      <VehicleMap vehicles={vehicles}\n        refresh={(refresh_rate - 5) * 1000}\n        palette={occupancyPalette}\n        />\n\n      <InfoPanel />\n\n      <Charts>\n        <BarChart data={occupancyTable}\n          xlab=\"Occupancy Status\"\n          />\n        <BarChart data={delaysTable}\n          xlab=\"Arrival and Departure Delays\"\n          />\n      </Charts>\n    </Container>\n  );\n}\n\nexport default App\n\nconst Container = styled.div``\n\nconst Charts = styled.div`\n  position: fixed;\n  z-index: 5;\n  top: 2em;\n  right: 2em;\n`\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}