(this["webpackJsonpbus-display"]=this["webpackJsonpbus-display"]||[]).push([[0],{66:function(e,t,n){},67:function(e,t,n){},89:function(e,t,n){"use strict";n.r(t);var i,c,a,r,o=n(0),s=n.n(o),u=n(32),l=n.n(u),f=(n(66),n(3)),d=n(18),b=n(1),p=n(4),j=(n(67),n(7)),O=n.n(j),v=n(33),h=n(37),g=n(2);O.a.workerClass=v.a,O.a.accessToken="pk.eyJ1IjoidG9tZWxsaW90dG56IiwiYSI6ImNrbmswb2hteDA1amwyb3A5YzlxZmZtMWoifQ.z4AcPvAC_QamiORckX-CTQ";var y,x=function(e){var t=e.vehicles,n=Object(o.useRef)(),i=Object(o.useState)(174.860478),c=Object(b.a)(i,2),a=c[0],r=(c[1],Object(o.useState)(-36.845794)),s=Object(b.a)(r,2),u=s[0],l=(s[1],Object(o.useState)(10)),f=Object(b.a)(l,2),d=f[0],p=(f[1],Object(o.useState)()),j=Object(b.a)(p,2),v=j[0],y=j[1],x=Object(o.useState)(),k=Object(b.a)(x,2),w=k[0],z=k[1],E=Object(o.useState)(),C=Object(b.a)(E,2),I=C[0],A=C[1],_=Object(o.useState)([]),F=Object(b.a)(_,2),L=F[0],T=F[1];return Object(o.useEffect)((function(){console.log("-- set map --"),z(new O.a.Map({container:n.current,style:{version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://abcd.basemaps.cartocdn.com/rastertiles/dark_nolabels/{z}/{x}/{y}.png"],tileSize:256}},layers:[{id:"simple-tiles",type:"raster",source:"raster-tiles",minzoom:0,maxzoom:22}]},center:[a,u],zoom:d}))}),[]),Object(o.useEffect)((function(){void 0!==w&&(console.log("-- set container --"),w.on("load",(function(){w.scrollZoom.disable(),y(w.getCanvasContainer())})))}),[w]),Object(o.useEffect)((function(){if(void 0!==v)return console.log("-- set svg --"),A(h.a(v).append("svg").attr("height","100%").attr("width","100%").style("position","absolute").style("z-index","2")),function(){return A()}}),[v]),Object(o.useEffect)((function(){void 0!==I&&0!==t.length&&(console.log("-- set data --"),T(t.map((function(e){return{id:e.key,pos:w.project(new O.a.LngLat(e.position.longitude,e.position.latitude))}}))))}),[I,t]),Object(o.useEffect)((function(){if(0!==L.length){console.log("-- set data points --");var e=I.selectAll("circle").data(L,(function(e){return e.id}));return e.exit().style("fill","green"),e.enter().append("circle").style("fill","red").attr("r",0).attr("cx",(function(e){return e.pos.x})).attr("cy",(function(e){return e.pos.y})).transition().duration(500).attr("r",5),e.transition().duration(2e4).attr("cx",(function(e){return e.pos.x})).attr("cy",(function(e){return e.pos.y})).style("fill","blue"),function(){return I.selectAll("circle").data([])}}}),[L,I]),Object(g.jsx)(m,{children:Object(g.jsx)(S,{ref:n})})},m=p.a.div(i||(i=Object(f.a)([""]))),S=p.a.div(c||(c=Object(f.a)(["\n    position: fixed;\n    top: 0;\n    left: 0;\n    height: 100vh;\n    width: 100vw;\n    background: #262626;\n"])));p.a.div(a||(a=Object(f.a)(["\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-around;\n"]))),p.a.div(r||(r=Object(f.a)(["\n  display: inline-block;\n  height: 20px;\n  width: 50px;\n  font-size: 10px;\n  background: pink;\n  margin: 1em;\n  text-align: center;\n  line-height: 20px;\n"])));var k=function(){var e=Object(o.useState)(!1),t=Object(b.a)(e,2),n=t[0],i=t[1],c=Object(o.useState)([]),a=Object(b.a)(c,2),r=a[0],s=a[1],u=Object(o.useState)([]),l=Object(b.a)(u,2),f=l[0],p=l[1],j=function(){if(!n){console.log(" --- fetch data --- "),i(!0);return fetch("https://api.at.govt.nz/v2/public/realtime/",{headers:{"Ocp-Apim-Subscription-Key":"921fa76f32d94d9d9d645f4db9f0f498"}}).then((function(e){if(e.ok)return e.json();console.log(e)})).then((function(e){return s(e.response.entity)})).then((function(){return i(!1)})),function(){return i(!1)}}};return Object(o.useEffect)((function(){j();var e=setInterval((function(){return j()}),3e4);return function(){return clearInterval(e)}}),[]),Object(o.useEffect)((function(){p(r.filter((function(e){return e.vehicle&&!e.is_deleted&&e.vehicle.position})).map((function(e){var t,n=r.filter((function(t){var n;return t.trip_update&&(null===(n=t.trip_update.vehicle)||void 0===n?void 0:n.id)===e.vehicle.vehicle.id}));return Object(d.a)(Object(d.a)({},e.vehicle),{},{key:e.vehicle.vehicle.id,trip_update:null===(t=n[0])||void 0===t?void 0:t.trip_update})})))}),[r]),Object(o.useEffect)((function(){}),[f]),Object(g.jsx)(w,{children:Object(g.jsx)(x,{vehicles:f})})},w=p.a.div(y||(y=Object(f.a)([""]))),z=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,90)).then((function(t){var n=t.getCLS,i=t.getFID,c=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),i(e),c(e),a(e),r(e)}))};l.a.render(Object(g.jsx)(s.a.StrictMode,{children:Object(g.jsx)(k,{})}),document.getElementById("root")),z()}},[[89,1,2]]]);
//# sourceMappingURL=main.b1eca920.chunk.js.map