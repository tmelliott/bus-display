(this["webpackJsonpbus-display"]=this["webpackJsonpbus-display"]||[]).push([[0],{108:function(t,e,n){},110:function(t,e,n){},131:function(t,e,n){"use strict";n.r(e);var c,o,a=n(0),i=n.n(a),r=n(61),l=n.n(r),s=(n(108),n(2)),u=n(22),d=n(66),b=n(4),f=n(3),p=n(16),j=(n(110),n(9)),h=n.n(j),O=n(62),v=n(1);h.a.workerClass=O.a,h.a.accessToken="pk.eyJ1IjoidG9tZWxsaW90dG56IiwiYSI6ImNrbmswb2hteDA1amwyb3A5YzlxZmZtMWoifQ.z4AcPvAC_QamiORckX-CTQ";var g,m,x,y,w,_,k=function(t){var e=t.vehicles,n=t.refresh,c=t.palette,o=Object(a.useRef)(),i=Object(a.useState)(174.860478),r=Object(b.a)(i,1)[0],l=Object(a.useState)(-36.845794),s=Object(b.a)(l,1)[0],u=Object(a.useState)(10),d=Object(b.a)(u,1)[0],f=Object(a.useState)(),j=Object(b.a)(f,2),O=j[0],g=j[1],m=Object(a.useState)(),x=Object(b.a)(m,2),y=x[0],w=x[1],_=Object(a.useState)(),k=Object(b.a)(_,2),A=k[0],E=k[1],C=Object(a.useState)([]),I=Object(b.a)(C,2),F=I[0],M=I[1];return Object(a.useEffect)((function(){console.log("-- set map --"),w(new h.a.Map({container:o.current,style:{version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://abcd.basemaps.cartocdn.com/rastertiles/dark_nolabels/{z}/{x}/{y}.png"],tileSize:256}},layers:[{id:"simple-tiles",type:"raster",source:"raster-tiles",minzoom:0,maxzoom:22}]},center:[r,s],zoom:d}))}),[s,r,d]),Object(a.useEffect)((function(){void 0!==y&&(console.log("-- set container --"),y.on("load",(function(){y.scrollZoom.disable(),g(y.getCanvasContainer())})))}),[y]),Object(a.useEffect)((function(){if(void 0!==O)return console.log("-- set svg --"),E(p.b(O).append("svg").attr("height","100%").attr("width","100%").style("position","absolute").style("z-index","2")),function(){return E()}}),[O]),Object(a.useEffect)((function(){void 0!==A&&0!==e.length&&(console.log("-- set data --"),M(e.map((function(t){return{id:t.key,pos:y.project(new h.a.LngLat(t.position.longitude,t.position.latitude)),occ_stat:t.occupancy_status,status:void 0===t.occupancy_status?0:t.occupancy_status+1}}))))}),[A,e,y]),Object(a.useEffect)((function(){if(0!==F.length){console.log("-- set data points --");var t=A.selectAll("circle").data(F,(function(t){return t.id}));return t.exit().transition().duration(500).attr("r",0).remove(),t.enter().append("circle").style("fill",(function(t){return c[t.status]})).attr("r",0).attr("cx",(function(t){return t.pos.x})).attr("cy",(function(t){return t.pos.y})).transition().duration(500).attr("r",5),t.transition().duration(n).attr("cx",(function(t){return t.pos.x})).attr("cy",(function(t){return t.pos.y})).style("fill",(function(t){return c[t.status]})),function(){return A.selectAll("circle").data([])}}}),[F,A,y,c,n]),Object(v.jsx)(S,{children:Object(v.jsx)(z,{ref:o})})},S=f.a.div(c||(c=Object(s.a)([""]))),z=f.a.div(o||(o=Object(s.a)(["\n    position: fixed;\n    top: 0;\n    left: 0;\n    height: 100vh;\n    width: 100vw;\n    background: #262626;\n"])));var A,E=function(t){var e=t.data,n=t.xlab,c=Object(a.useState)(0),o=Object(b.a)(c,2),i=o[0],r=o[1];return Object(a.useEffect)((function(){0!==e.length&&r(Math.max.apply(Math,e.map((function(t){return t.count}))))}),[e]),Object(v.jsxs)(C,{children:[Object(v.jsx)(I,{children:n}),e.length&&e.map((function(t){return Object(v.jsxs)(F,{children:[Object(v.jsx)(M,{height:t.count/i*100,colour:t.colour}),Object(v.jsx)(L,{children:t.count}),Object(v.jsx)(T,{children:t.label})]})}))]})},C=f.a.div(g||(g=Object(s.a)(["\n    margin-bottom: 2em;\n    /* left: 2em;\n    bottom: 2em; */\n    height: 30vh;\n    width: 30vw;\n    display: flex;\n    flex-direction: column;\n    background: rgba(0,0,0,0.3);\n    padding: 0.5em;\n    border: solid 4px white;\n"]))),I=f.a.div(m||(m=Object(s.a)(["\n    color: white;\n    /* width: 180px; */\n    /* text-align: right; */\n    font-weight: bold;\n    /* background: pink; */\n"]))),F=f.a.div(x||(x=Object(s.a)(["\n    width: 100%;\n    flex: 1;\n    display: flex;\n    flex-direction: row-reverse;\n    color: white;\n    text-align: center;\n    font-weight: bold;\n    font-size: 0.7em;\n    overflow: hidden;\n"]))),M=f.a.div(y||(y=Object(s.a)(["\n    flex: 1;\n    margin: 2px 0;\n    position: relative;\n\n    &:before {\n        content: '';\n        display: block;\n        position: absolute;\n        height: 100%;\n        left: 0;\n        width: ","%;\n        background: ",";\n        transition: width 5s ease-in-out;\n    }\n"])),(function(t){return t.height}),(function(t){return t.colour})),L=f.a.div(w||(w=Object(s.a)(["\n    padding: 0.5em;\n    width: 3em;\n    align-items: center;\n    display: flex;\n    justify-content: center;\n"]))),T=f.a.div(_||(_=Object(s.a)(["\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    border-right: solid 1px white;\n    padding-right: 10px;\n    width: 180px;\n    overflow: hidden;\n"])));var D,P,Z=function(){return Object(v.jsxs)(B,{children:[Object(v.jsxs)("p",{children:[Object(v.jsx)("strong",{children:"Real-time positions of buses"})," are obtained through Auckland Tranport's public API, which includes ",Object(v.jsx)("strong",{children:"arrival/departure delays"})," at the most recently visited stop. Buses between ",Object(v.jsx)("strong",{children:"1 minute early and 5 minutes late"})," are defined as ",Object(v.jsx)("strong",{children:"on time"}),"."]}),Object(v.jsxs)("p",{children:["Location points are coloured by the bus's ",Object(v.jsx)("strong",{children:"occupancy status"}),", which indicates the number of passengers on board."]})]})},B=f.a.div(A||(A=Object(s.a)(["\n    position: fixed;\n    top: 1.0em;\n    left: 1.0em;\n    width: 25vw;\n    z-index: 1000;\n\n    font-size: 1.2rem;\n    line-height: 1.5;\n    background: rgba(0,0,0,0.4);\n    padding: 1em 2em 0;\n    color: #fff;\n    border: 4px solid #fff;\n\n    p {\n        margin: 0 0 1em 0;\n    }\n\n"])));var J=function(){var t=Object(a.useState)([]),e=Object(b.a)(t,2),n=e[0],c=e[1],o=Object(a.useState)([]),i=Object(b.a)(o,2),r=i[0],l=i[1],s=Object(a.useState)([]),f=Object(b.a)(s,2),j=f[0],h=f[1],O=Object(a.useState)([]),g=Object(b.a)(O,2),m=g[0],x=g[1],y=[].concat(Object(d.a)(p.a[7]),["#cecece"]).reverse();return Object(a.useEffect)((function(){var t=!1,e=function(){if(!t){console.log(" --- fetch data --- "),t=!0;return fetch("https://api.at.govt.nz/v2/public/realtime/",{headers:{"Ocp-Apim-Subscription-Key":"921fa76f32d94d9d9d645f4db9f0f498"}}).then((function(t){if(t.ok)return t.json();console.log(t)})).then((function(t){return c(t.response.entity)})).then((function(){t=!1})),function(){t=!1}}};e();var n=setInterval((function(){return e()}),3e4);return function(){return clearInterval(n)}}),[]),Object(a.useEffect)((function(){l(n.filter((function(t){return t.vehicle&&!t.is_deleted&&t.vehicle.position})).map((function(t){var e,c=n.filter((function(e){var n;return e.trip_update&&(null===(n=e.trip_update.vehicle)||void 0===n?void 0:n.id)===t.vehicle.vehicle.id}));return Object(u.a)(Object(u.a)({},t.vehicle),{},{key:t.vehicle.vehicle.id,trip_update:null===(e=c[0])||void 0===e?void 0:e.trip_update})})))}),[n]),Object(a.useEffect)((function(){for(var t=r.map((function(t){return void 0===t.occupancy_status?0:t.occupancy_status+1})),e=new Array(8).fill(0),n=0;n<t.length;n++)e[t[n]]++;h([{label:"Unknown",count:e[0],colour:y[0]},{label:"Empty",count:e[1],colour:y[1]},{label:"Many seats",count:e[2],colour:y[2]},{label:"Few seats",count:e[3],colour:y[3]},{label:"Standing room only",count:e[4],colour:y[4]},{label:"Crushed standing room only",count:e[5],colour:y[5]},{label:"Full",count:e[6],colour:y[6]},{label:"Not accepting passengers",count:e[7],colour:y[7]}]);var c=r.map((function(t){if(void 0!==t.trip_update)return t.trip_update.stop_time_update.arrival?t.trip_update.stop_time_update.arrival.delay:t.trip_update.stop_time_update.departure.delay}));e=new Array(8).fill(0),console.log(c);for(var o=0;o<c.length;o++)void 0===c[o]?e[0]++:c[o]<=-300?e[1]++:c[o]<=60?e[2]++:c[o]>=300?e[3]++:c[o]>=600?e[4]++:c[o]>=1200?e[5]++:c[o]>=1800?e[6]++:e[7]++;x([{label:"No data",count:e[0],colour:"#95a5a6"},{label:">5m early",count:e[1],colour:"#3c42a5"},{label:"1-5m early",count:e[2],colour:"#28aebb"},{label:"On time",count:e[3],colour:"#26d926"},{label:"5-10m late",count:e[4],colour:"#f39c12"},{label:"10-20m late",count:e[5],colour:"#d35400"},{label:"20-30m late",count:e[6],colour:"red"},{label:"30+m late",count:e[7],colour:"#990000"}])}),[r]),Object(v.jsxs)(N,{children:[Object(v.jsx)(k,{vehicles:r,refresh:25e3,palette:y}),Object(v.jsx)(Z,{}),Object(v.jsxs)(Q,{children:[Object(v.jsx)(E,{data:j,xlab:"Occupancy Status"}),Object(v.jsx)(E,{data:m,xlab:"Arrival and Departure Delays"})]})]})},N=f.a.div(D||(D=Object(s.a)([""]))),Q=f.a.div(P||(P=Object(s.a)(["\n  position: fixed;\n  z-index: 5;\n  top: 2em;\n  right: 2em;\n"]))),R=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,132)).then((function(e){var n=e.getCLS,c=e.getFID,o=e.getFCP,a=e.getLCP,i=e.getTTFB;n(t),c(t),o(t),a(t),i(t)}))};l.a.render(Object(v.jsx)(i.a.StrictMode,{children:Object(v.jsx)(J,{})}),document.getElementById("root")),R()}},[[131,1,2]]]);
//# sourceMappingURL=main.6273bf76.chunk.js.map