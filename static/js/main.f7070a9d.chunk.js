(this["webpackJsonpbus-display"]=this["webpackJsonpbus-display"]||[]).push([[0],{115:function(e,t,n){},117:function(e,t,n){},138:function(e,t,n){"use strict";n.r(t);var i,a,o=n(0),c=n.n(o),r=n(68),l=n.n(r),s=(n(115),n(2)),u=n(30),d=n(73),b=n(4),p=n(3),f=n(9),h=(n(117),n(10)),j=n.n(h),m=n(69),x=n(1);j.a.workerClass=m.a,j.a.accessToken="pk.eyJ1IjoidG9tZWxsaW90dG56IiwiYSI6ImNrbmswb2hteDA1amwyb3A5YzlxZmZtMWoifQ.z4AcPvAC_QamiORckX-CTQ";var v,O,g,y,w,k,_=function(e){var t=e.vehicles,n=e.refresh,i=e.palette,a=e.cvar,c=Object(o.useRef)(),r=Object(o.useState)(174.812378),l=Object(b.a)(r,1)[0],s=Object(o.useState)(-36.845794),u=Object(b.a)(s,1)[0],d=Object(o.useState)(12),p=Object(b.a)(d,1)[0],h=Object(o.useState)(),m=Object(b.a)(h,2),v=m[0],O=m[1],g=Object(o.useState)(),y=Object(b.a)(g,2),w=y[0],k=y[1],_=Object(o.useState)(),A=Object(b.a)(_,2),E=A[0],C=A[1],I=Object(o.useState)([]),T=Object(b.a)(I,2),D=T[0],F=T[1];return Object(o.useEffect)((function(){console.log("-- set map --"),k(new j.a.Map({container:c.current,style:{version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://abcd.basemaps.cartocdn.com/rastertiles/dark_nolabels/{z}/{x}/{y}.png"],tileSize:256}},layers:[{id:"simple-tiles",type:"raster",source:"raster-tiles",minzoom:0,maxzoom:22}]},center:[l,u],zoom:p}))}),[u,l,p]),Object(o.useEffect)((function(){void 0!==w&&(console.log("-- set container --"),w.on("load",(function(){w.scrollZoom.disable(),O(w.getCanvasContainer())})))}),[w]),Object(o.useEffect)((function(){if(void 0!==v)return console.log("-- set svg --"),C(f.c(v).append("svg").attr("height","100%").attr("width","100%").style("position","absolute").style("z-index","2")),function(){return C()}}),[v]),Object(o.useEffect)((function(){void 0!==E&&0!==t.length&&F(t.map((function(e){return{id:e.key,pos:w.project(new j.a.LngLat(e.position.longitude,e.position.latitude)),status:void 0===a(e)?0:a(e)+1}})).sort((function(e,t){return e.status-t.status})))}),[E,t,w]),Object(o.useEffect)((function(){if(0!==D.length){console.log("-- set data points --");var e=E.selectAll("circle").data(D,(function(e){return e.id}));return e.exit().transition().duration(500).attr("r",0).remove(),e.enter().append("circle").style("fill",(function(e){return i[e.status]})).attr("r",0).attr("cx",(function(e){return e.pos.x})).attr("cy",(function(e){return e.pos.y})).transition().duration(500).attr("r",5),e.transition().ease(f.a).duration(n).attr("cx",(function(e){return e.pos.x})).attr("cy",(function(e){return e.pos.y})).style("fill",(function(e){return i[e.status]})),function(){return E.selectAll("circle").data([])}}}),[D,E,w,i,n]),Object(x.jsx)(S,{children:Object(x.jsx)(z,{ref:c})})},S=p.a.div(i||(i=Object(s.a)([""]))),z=p.a.div(a||(a=Object(s.a)(["\n    position: fixed;\n    top: 0;\n    left: 0;\n    height: 100vh;\n    width: 100vw;\n    background: #262626;\n"])));var A,E,C,I=function(e){var t=e.data,n=e.xlab,i=Object(o.useState)(0),a=Object(b.a)(i,2),c=a[0],r=a[1];return Object(o.useEffect)((function(){0!==t.length&&r(t.reduce((function(e,t){return Math.max(e,t.count)}),0))}),[t]),Object(x.jsxs)(T,{children:[Object(x.jsx)(D,{children:n}),t.length&&t.map((function(e){return Object(x.jsxs)(F,{children:[Object(x.jsx)(M,{height:e.count/c*100,colour:e.colour}),Object(x.jsx)(P,{children:e.count}),Object(x.jsx)(L,{children:e.label})]},e.label)}))]})},T=p.a.div(v||(v=Object(s.a)(["\n    margin-bottom: 2em;\n    margin-top: 1em;\n    /* left: 2em;\n    bottom: 2em; */\n    /* height: 30vh; */\n    display: flex;\n    flex-direction: column;\n    /* background: rgba(0,0,0,0.3); */\n    /* padding: 0.5em; */\n    border-top: solid 4px white;\n    /* padding-top: 0.5em; */\n    border-bottom: solid 1px white;\n"]))),D=p.a.div(O||(O=Object(s.a)(["\n    color: white;\n    /* width: 180px; */\n    /* text-align: right; */\n    font-weight: bold;\n    /* background: pink; */\n    padding: 0.5em;\n    border-bottom: solid 1px white;\n"]))),F=p.a.div(g||(g=Object(s.a)(["\n    width: 100%;\n    flex: 1;\n    display: flex;\n    flex-direction: row-reverse;\n    color: white;\n    text-align: center;\n    font-weight: bold;\n    font-size: 0.7em;\n    overflow: hidden;\n    height: 2em;\n"]))),M=p.a.div(y||(y=Object(s.a)(["\n    flex: 1;\n    margin: 2px 0;\n    position: relative;\n\n    &:before {\n        content: '';\n        display: block;\n        position: absolute;\n        height: 100%;\n        left: 0;\n        width: ","%;\n        background: ",";\n        transition: width 5s ease-in-out;\n    }\n"])),(function(e){return.85*e.height}),(function(e){return e.colour})),P=p.a.div(w||(w=Object(s.a)(["\n    padding: 0.5em;\n    width: 3em;\n    align-items: center;\n    display: flex;\n    justify-content: center;\n"]))),L=p.a.div(k||(k=Object(s.a)(["\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    border-right: solid 1px white;\n    padding-right: 10px;\n    width: 180px;\n    overflow: hidden;\n"])));var N,R,W,Z=function(e){var t=e.total,n=e.refresh;return Object(x.jsxs)(J,{children:[Object(x.jsxs)("p",{children:[Object(x.jsx)("strong",{children:"Real-time vehicle locations"})," of buses and trains are obtained from Auckland Transport's public API. The data on the map is updated once every ",Object(x.jsxs)("strong",{children:[n," seconds"]}),". Animations are interpolated between consecutive locations (so don't worry if you see a bus swimming in the Waitemat\u0101)."]}),Object(x.jsxs)("p",{children:["Map points are coloured by the bus's ",Object(x.jsx)("strong",{children:"occupancy status"}),", which indicates the number of passengers on board."]}),Object(x.jsx)(Q,{children:Object(x.jsxs)(B,{children:[Object(x.jsx)("label",{children:"Total Vehicles:"}),Object(x.jsx)("p",{children:t})]})})]})},J=p.a.div(A||(A=Object(s.a)(["\n    /* position: fixed;\n    top: 1.0em;\n    left: 1.0em;\n    width: 25vw;\n    z-index: 1000; */\n\n    width: 100%;\n    font-size: 1.2rem;\n    line-height: 1.5;\n    /* background: rgba(0,0,0,0.4); */\n    /* padding: 1em 2em 0; */\n    color: #fff;\n    /* border: 4px solid #fff; */\n\n    p {\n        margin: 0 0 1em 0;\n    }\n\n"]))),Q=p.a.div(E||(E=Object(s.a)(["\n    font-size: 1.5em;\n"]))),B=p.a.div(C||(C=Object(s.a)(["\n    display: flex;\n    label {\n        /* display: inline-block; */\n        width: 50%;\n        text-align: right;\n        padding-right: 1em;\n    }\n"])));var G=function(){var e=Object(o.useState)([]),t=Object(b.a)(e,2),n=t[0],i=t[1],a=Object(o.useState)([]),c=Object(b.a)(a,2),r=c[0],l=c[1],s=Object(o.useState)([]),p=Object(b.a)(s,2),h=p[0],j=p[1],m=Object(o.useState)([]),v=Object(b.a)(m,2),O=v[0],g=v[1],y=[].concat(Object(d.a)(f.b[5]),["#cecece"]).reverse(),w=[y[0],y[1],y[2],y[3],y[4],y[4],y[5],y[5]],k=["#95a5a6","#3c42a5","#28aebb","#26d926","#f39c12","#d35400","red","#990000"];return Object(o.useEffect)((function(){var e=!1,t=function(){if(!e){console.log(" --- fetch data --- "),e=!0;return fetch("https://api.at.govt.nz/v2/public/realtime/",{headers:{"Ocp-Apim-Subscription-Key":"921fa76f32d94d9d9d645f4db9f0f498"}}).then((function(e){if(e.ok)return e.json()})).then((function(e){return i(e.response.entity)})).then((function(){e=!1})),function(){e=!1}}};t();var n=setInterval((function(){return t()}),2e4);return function(){return clearInterval(n)}}),[]),Object(o.useEffect)((function(){l(n.filter((function(e){return!e.is_deleted&&e.vehicle&&e.vehicle.trip&&e.vehicle.timestamp>Date.now()/1e3-300&&e.vehicle.position&&e.vehicle.position.latitude>-38&&e.vehicle.position.latitude<-36&&e.vehicle.position.longitude>174&&e.vehicle.position.longitude<176})).map((function(e){var t,i=n.filter((function(t){var n;return t.trip_update&&(null===(n=t.trip_update.vehicle)||void 0===n?void 0:n.id)===e.vehicle.vehicle.id}));return Object(u.a)(Object(u.a)({},e.vehicle),{},{key:e.vehicle.vehicle.id,trip_update:null===(t=i[0])||void 0===t?void 0:t.trip_update})})))}),[n]),Object(o.useEffect)((function(){for(var e=r.map((function(e){return void 0===e.occupancy_status?0:e.occupancy_status+1})),t=new Array(8).fill(0),n=0;n<e.length;n++)t[e[n]]++;j([{label:"No data",count:t[0],colour:w[0]},{label:"Empty",count:t[1],colour:w[1]},{label:"Many seats",count:t[2],colour:w[2]},{label:"Few seats",count:t[3],colour:w[3]},{label:"Standing room only",count:t[4]+t[5],colour:w[4]},{label:"Full / Not accepting passengers",count:t[6]+t[7],colour:w[6]}]);var i,a=r.map((function(e){if(void 0!==e.trip_update&&void 0!==e.trip_update.stop_time_update)return e.trip_update.stop_time_update.arrival?e.trip_update.stop_time_update.arrival.delay:e.trip_update.stop_time_update.departure.delay}));t=new Array(8).fill(0);for(var o=0;o<a.length;o++){t[void 0===(i=a[o])?0:i<=-300?1:i<=-60?2:i<=300?3:i<=600?4:i<=1200?5:i<=1800?6:7]++}g([{label:"No data",count:t[0],colour:k[0]},{label:">5m early",count:t[1],colour:k[1]},{label:"1-5m early",count:t[2],colour:k[2]},{label:"On time",count:t[3],colour:k[3]},{label:"5-10m late",count:t[4],colour:k[4]},{label:"10-20m late",count:t[5],colour:k[5]},{label:"20-30m late",count:t[6],colour:k[6]},{label:"30+m late",count:t[7],colour:k[7]}])}),[r]),Object(x.jsxs)(V,{children:[Object(x.jsx)(_,{vehicles:r,refresh:19e3,palette:w,cvar:function(e){return e.occupancy_status}}),Object(x.jsxs)(K,{children:[Object(x.jsx)("h1",{children:"Real-time Public Transport Data"}),Object(x.jsx)("h2",{children:"Vehicle Occupancy in Central Auckland"})]}),Object(x.jsxs)(Y,{children:[Object(x.jsx)(Z,{total:r.length,refresh:20}),Object(x.jsx)(I,{data:h,xlab:"Occupancy Status"}),Object(x.jsx)(I,{data:O,xlab:"Arrival and Departure Delays"})]})]})},V=p.a.div(N||(N=Object(s.a)([""]))),Y=p.a.div(R||(R=Object(s.a)(["\n  position: fixed;\n  z-index: 5;\n  top: 2em;\n  right: 2em;\n  bottom: 2em;\n  width: 30em;\n  padding: 1em 2em;\n  background: rgba(0,0,0,0.7);\n  display: flex;\n  flex-direction: column;\n  /* justify-content: space-between; */\n  box-shadow: 5px 3px 10px 5px rgba(0,0,0,0.4);\n  border-radius: 5px;\n"]))),K=p.a.div(W||(W=Object(s.a)(["\n  position: fixed;\n  z-index: 10;\n  top: 1em;\n  left: 0em;\n  color: black;\n  padding: 1em 3em;\n  width: 50vw;\n  text-align: right;\n  background: rgba(255,255,255,0.8);\n  box-shadow: 5px 3px 10px 10px rgba(0,0,0,0.4);\n  border-radius: 0 3px 3px 0;\n\n  h1 {\n    font-size: 45px;\n  }\n  h2 {\n    font-size: 30px;\n    font-style: italic;\n  }\n"]))),X=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,139)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,o=t.getLCP,c=t.getTTFB;n(e),i(e),a(e),o(e),c(e)}))};l.a.render(Object(x.jsx)(c.a.StrictMode,{children:Object(x.jsx)(G,{})}),document.getElementById("root")),X()}},[[138,1,2]]]);
//# sourceMappingURL=main.f7070a9d.chunk.js.map